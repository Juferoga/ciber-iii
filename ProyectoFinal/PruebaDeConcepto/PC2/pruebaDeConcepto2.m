% Limpia el entorno
close all;
clear;
clc;

% Datos de entrada y salida (reemplaza estos datos con tus propios valores)
% Los datos de entrada y salida ahora están almacenados en variables en lugar de leerse desde un archivo de Excel
% Datos de entrada
entradas = [
    1.0 3.0 3.0 1.0;
    0.0 1.0 0.0 0.0;
    3.0 1.0 3.0 2.0;
    1.0 1.0 1.0 1.0;
    2.0 2.0 2.0 1.0;
    1.0 1.0 1.0 0.0;
    0.0 0.0 3.0 3.0;
    2.0 3.0 2.0 2.0;
    2.0 3.0 3.0 1.0;
    1.0 3.0 3.0 1.0;
    0.0 1.0 1.0 0.0;
    2.0 2.0 2.0 0.0;
    1.0 2.0 2.0 2.0;
    3.0 1.0 3.0 3.0;
    1.0 2.0 2.0 2.0;
    2.0 2.0 2.0 2.0;
    2.0 2.0 1.0 1.0;
    2.0 2.0 2.0 2.0;
    2.0 2.0 1.0 2.0;
    2.0 3.0 1.0 2.0;
    0.0 0.0 2.0 3.0;
    1.0 1.0 0.0 1.0;
    0.0 0.0 0.0 3.0;
    0.0 0.0 0.0 0.0;
    0.0 3.0 3.0 3.0;
    1.0 0.0 0.0 0.0;
    1.0 2.0 3.0 2.0;
    1.0 0.0 0.0 1.0;
    2.0 0.0 3.0 3.0;
    2.0 1.0 1.0 2.0;
    2.0 3.0 3.0 0.0;
    1.0 3.0 2.0 3.0;
    0.0 1.0 0.0 0.0;
    1.0 1.0 1.0 1.0;
    2.0 2.0 1.0 3.0;
    3.0 1.0 1.0 2.0;
    0.0 0.0 0.0 0.0;
    1.0 1.0 3.0 3.0;
    2.0 2.0 2.0 1.0;
    1.0 1.0 2.0 2.0;
    2.0 2.0 3.0 2.0;
    1.0 3.0 2.0 1.0;
    0.0 0.0 1.0 0.0;
    0.0 0.0 3.0 3.0;
    2.0 1.0 1.0 2.0;
    0.0 0.0 1.0 1.0;
    3.0 3.0 2.0 0.0;
    0.0 2.0 0.0 2.0;
    2.0 3.0 2.0 3.0;
    0.0 0.0 1.0 0.0;
    1.0 2.0 2.0 2.0;
    1.0 1.0 1.0 3.0;
    2.0 1.0 2.0 2.0;
    2.0 3.0 3.0 3.0;
    3.0 0.0 3.0 2.0;
    0.0 2.0 2.0 2.0;
    3.0 1.0 1.0 3.0;
    2.0 1.0 1.0 2.0;
    3.0 3.0 2.0 3.0;
    3.0 3.0 1.0 1.0;
    3.0 2.0 0.0 3.0;
    0.0 0.0 2.0 3.0;
    2.0 2.0 3.0 3.0;
    2.0 0.0 0.0 2.0;
    1.0 1.0 1.0 0.0;
    1.0 0.0 0.0 0.0;
    0.0 0.0 1.0 1.0;
    2.0 1.0 3.0 1.0;
    2.0 2.0 3.0 2.0;
    0.0 0.0 0.0 1.0;
    2.0 2.0 2.0 2.0;
    1.0 1.0 1.0 1.0;
    1.0 2.0 2.0 2.0;
    3.0 3.0 0.0 0.0;
    3.0 3.0 2.0 3.0;
    2.0 2.0 2.0 2.0;
    0.0 1.0 1.0 0.0;
    2.0 1.0 2.0 1.0;
    3.0 0.0 0.0 0.0;
    3.0 3.0 0.0 0.0;
    2.0 0.0 2.0 0.0;
    1.0 2.0 1.0 1.0;
    0.0 0.0 2.0 0.0;
    3.0 1.0 3.0 1.0;
    1.0 0.0 0.0 1.0;
    2.0 1.0 2.0 3.0;
    2.0 1.0 2.0 2.0;
    2.0 3.0 2.0 3.0;
    1.0 1.0 2.0 2.0;
    1.0 2.0 1.0 1.0;
    2.0 3.0 1.0 2.0;
    2.0 3.0 2.0 1.0;
    0.0 2.0 3.0 0.0;
    0.0 0.0 2.0 2.0;
    3.0 3.0 3.0 2.0;
    2.0 1.0 1.0 2.0;
    1.0 2.0 3.0 2.0;
    1.0 1.0 1.0 1.0;
    1.0 1.0 1.0 0.0;
    1.0 2.0 1.0 1.0;
    0.0 0.0 3.0 2.0;
    1.0 1.0 1.0 0.0;
    3.0 1.0 2.0 2.0;
    1.0 1.0 2.0 1.0;
    2.0 3.0 2.0 1.0;
    1.0 2.0 1.0 1.0;
    1.0 0.0 0.0 1.0;
    1.0 1.0 2.0 2.0;
    2.0 2.0 1.0 2.0;
    0.0 0.0 1.0 0.0;
    3.0 1.0 2.0 1.0;
    3.0 2.0 3.0 1.0;
    1.0 1.0 2.0 2.0;
    0.0 0.0 1.0 1.0;
    2.0 1.0 2.0 2.0;
    2.0 2.0 1.0 1.0;
    0.0 2.0 2.0 0.0;
    2.0 2.0 2.0 1.0;
    2.0 3.0 2.0 2.0;
    2.0 1.0 1.0 1.0;
    3.0 2.0 0.0 3.0;
    2.0 3.0 0.0 0.0;
    0.0 0.0 0.0 1.0;
    1.0 1.0 2.0 3.0;
    0.0 0.0 3.0 2.0;
    1.0 1.0 2.0 1.0;
    1.0 2.0 1.0 2.0;
    2.0 2.0 2.0 1.0;
    0.0 1.0 1.0 0.0;
    1.0 1.0 1.0 2.0;
    0.0 0.0 0.0 0.0;
    2.0 0.0 0.0 3.0;
    0.0 1.0 1.0 1.0;
    0.0 1.0 1.0 0.0;
    2.0 1.0 2.0 1.0;
    1.0 3.0 1.0 3.0;
    1.0 0.0 0.0 1.0;
    0.0 2.0 0.0 3.0;
    1.0 1.0 1.0 3.0;
    0.0 3.0 2.0 3.0;
    3.0 2.0 3.0 0.0;
    0.0 1.0 0.0 1.0;
    1.0 1.0 3.0 1.0;
    1.0 1.0 2.0 2.0;
    2.0 3.0 2.0 1.0;
    3.0 1.0 3.0 3.0;
    1.0 2.0 1.0 2.0;
    2.0 1.0 1.0 2.0;
    2.0 1.0 2.0 1.0;
    1.0 2.0 2.0 1.0;
    0.0 1.0 0.0 1.0;
    0.0 0.0 2.0 0.0;
    3.0 1.0 1.0 2.0;
    3.0 3.0 0.0 2.0;
    3.0 2.0 2.0 3.0;
    2.0 3.0 1.0 1.0;
    2.0 2.0 2.0 2.0;
    0.0 3.0 0.0 3.0;
    0.0 0.0 1.0 1.0;
    0.0 1.0 0.0 0.0;
    0.0 2.0 0.0 2.0;
    2.0 1.0 2.0 1.0;
    0.0 0.0 1.0 1.0;
    0.0 1.0 0.0 1.0;
    3.0 1.0 2.0 3.0;
    0.0 1.0 0.0 0.0;
    0.0 1.0 1.0 0.0;
    3.0 0.0 3.0 2.0;
    2.0 0.0 2.0 2.0;
    2.0 2.0 0.0 0.0;
    3.0 2.0 3.0 0.0;
    0.0 0.0 1.0 0.0;
    0.0 0.0 2.0 3.0;
    1.0 1.0 0.0 1.0;
    0.0 0.0 1.0 1.0;
    2.0 2.0 3.0 0.0;
    0.0 1.0 0.0 1.0;
    1.0 1.0 0.0 0.0;
    1.0 2.0 3.0 1.0;
    1.0 1.0 1.0 1.0;
    1.0 0.0 0.0 0.0;
    0.0 1.0 0.0 1.0;
    0.0 0.0 3.0 0.0;
    1.0 1.0 1.0 1.0;
    0.0 1.0 1.0 0.0;
    0.0 1.0 0.0 1.0;
    0.0 0.0 0.0 1.0;
    1.0 1.0 2.0 2.0;
    2.0 1.0 2.0 1.0;
    2.0 2.0 2.0 2.0;
    3.0 2.0 1.0 2.0;
    0.0 2.0 2.0 3.0;
    0.0 1.0 0.0 0.0;
    3.0 1.0 1.0 2.0;
    1.0 1.0 1.0 2.0;
    2.0 2.0 2.0 2.0;
    2.0 1.0 1.0 1.0;
    2.0 1.0 2.0 1.0;
    3.0 2.0 3.0 2.0;
    1.0 1.0 1.0 2.0;
    0.0 2.0 0.0 0.0;
    2.0 1.0 2.0 1.0;
    1.0 1.0 2.0 1.0;
    3.0 1.0 3.0 3.0;
    3.0 3.0 2.0 0.0;
    3.0 3.0 1.0 2.0;
    1.0 0.0 0.0 0.0;
    1.0 1.0 1.0 0.0;
    1.0 2.0 1.0 1.0;
    1.0 1.0 1.0 1.0;
    1.0 1.0 0.0 0.0;
    1.0 0.0 0.0 0.0;
    1.0 2.0 2.0 1.0;
    1.0 1.0 2.0 1.0;
    0.0 3.0 0.0 3.0;
    3.0 2.0 2.0 2.0;
    3.0 2.0 2.0 0.0;
    2.0 1.0 2.0 1.0;
    3.0 3.0 3.0 2.0;
    3.0 1.0 2.0 2.0;
    1.0 1.0 1.0 2.0;
    0.0 0.0 1.0 1.0;
    1.0 1.0 3.0 2.0;
    2.0 2.0 1.0 1.0;
    1.0 0.0 1.0 1.0;
    1.0 1.0 2.0 3.0;
    3.0 2.0 2.0 3.0;
    0.0 3.0 2.0 0.0;
    1.0 1.0 1.0 1.0;
    1.0 2.0 1.0 1.0;
    1.0 1.0 1.0 1.0;
    1.0 2.0 2.0 1.0;
    2.0 3.0 2.0 2.0;
    1.0 2.0 1.0 1.0;
    3.0 3.0 3.0 1.0;
    3.0 2.0 2.0 3.0;
    3.0 2.0 2.0 0.0;
    2.0 2.0 1.0 2.0;
    1.0 0.0 0.0 1.0;
    1.0 1.0 2.0 1.0;
    2.0 2.0 2.0 1.0;
    0.0 0.0 3.0 0.0;
    2.0 2.0 2.0 1.0;
    1.0 1.0 2.0 1.0;
    3.0 1.0 2.0 2.0;
    2.0 0.0 3.0 2.0;
    2.0 0.0 2.0 0.0;
    1.0 1.0 1.0 1.0;
    3.0 2.0 3.0 3.0;
    1.0 1.0 1.0 2.0;
    2.0 2.0 0.0 3.0;
    1.0 1.0 0.0 0.0;
    1.0 1.0 1.0 1.0;
    0.0 3.0 0.0 0.0;
    2.0 2.0 1.0 1.0;
    0.0 0.0 0.0 1.0;
    2.0 2.0 1.0 1.0;
    1.0 2.0 2.0 2.0;
    2.0 3.0 1.0 2.0;
    0.0 0.0 0.0 0.0;
    0.0 0.0 0.0 0.0;
    2.0 1.0 2.0 2.0;
    3.0 3.0 2.0 2.0;
    3.0 3.0 2.0 3.0;
    1.0 1.0 2.0 3.0;
    1.0 2.0 1.0 1.0;
    0.0 0.0 0.0 0.0;
    2.0 2.0 2.0 2.0;
    0.0 1.0 0.0 1.0;
    1.0 1.0 1.0 2.0;
    1.0 1.0 1.0 0.0;
    1.0 0.0 0.0 0.0;
    0.0 2.0 3.0 3.0;
    3.0 2.0 3.0 3.0;
    1.0 0.0 1.0 1.0;
    2.0 2.0 3.0 3.0;
    2.0 1.0 2.0 2.0;
    1.0 1.0 1.0 0.0;
    0.0 1.0 1.0 0.0;
    0.0 0.0 3.0 2.0;
    1.0 0.0 1.0 0.0;
    1.0 1.0 2.0 2.0;
    1.0 0.0 0.0 0.0;
    1.0 1.0 2.0 2.0;
    2.0 3.0 0.0 0.0;
    2.0 3.0 3.0 3.0;
    0.0 0.0 0.0 0.0;
    2.0 1.0 1.0 2.0;
    0.0 0.0 1.0 0.0;
    1.0 2.0 2.0 1.0;
    1.0 2.0 1.0 1.0;
    3.0 3.0 3.0 3.0;
    2.0 1.0 1.0 2.0;
    1.0 2.0 1.0 1.0;
    0.0 0.0 1.0 1.0;
    2.0 0.0 0.0 3.0;
    1.0 0.0 0.0 1.0;
    2.0 2.0 1.0 1.0;
    0.0 3.0 0.0 0.0;
    1.0 1.0 1.0 2.0;
];
% Observaciones del nivel de retinopatía
observaciones = [
    3.0;
    1.0;
    3.0;
    1.0;
    2.0;
    1.0;
    4.0;
    3.0;
    3.0;
    3.0;
    1.0;
    4.0;
    2.0;
    3.0;
    2.0;
    4.0;
    2.0;
    2.0;
    2.0;
    3.0;
    4.0;
    1.0;
    4.0;
    1.0;
    4.0;
    1.0;
    3.0;
    1.0;
    4.0;
    2.0;
    4.0;
    3.0;
    1.0;
    2.0;
    3.0;
    3.0;
    1.0;
    3.0;
    3.0;
    2.0;
    4.0;
    3.0;
    1.0;
    4.0;
    2.0;
    1.0;
    4.0;
    4.0;
    4.0;
    1.0;
    3.0;
    3.0;
    2.0;
    4.0;
    4.0;
    4.0;
    3.0;
    2.0;
    4.0;
    3.0;
    4.0;
    4.0;
    3.0;
    4.0;
    1.0;
    1.0;
    1.0;
    3.0;
    4.0;
    1.0;
    4.0;
    3.0;
    2.0;
    4.0;
    4.0;
    2.0;
    1.0;
    3.0;
    4.0;
    4.0;
    4.0;
    2.0;
    4.0;
    3.0;
    1.0;
    3.0;
    2.0;
    4.0;
    2.0;
    2.0;
    3.0;
    3.0;
    4.0;
    4.0;
    4.0;
    2.0;
    3.0;
    1.0;
    1.0;
    2.0;
    4.0;
    1.0;
    3.0;
    2.0;
    3.0;
    2.0;
    1.0;
    2.0;
    2.0;
    1.0;
    3.0;
    3.0;
    2.0;
    1.0;
    2.0;
    2.0;
    4.0;
    3.0;
    4.0;
    3.0;
    4.0;
    4.0;
    1.0;
    3.0;
    4.0;
    2.0;
    3.0;
    2.0;
    1.0;
    2.0;
    4.0;
    4.0;
    1.0;
    1.0;
    2.0;
    3.0;
    1.0;
    4.0;
    3.0;
    4.0;
    4.0;
    1.0;
    3.0;
    3.0;
    3.0;
    3.0;
    2.0;
    2.0;
    3.0;
    2.0;
    1.0;
    4.0;
    3.0;
    4.0;
    3.0;
    3.0;
    2.0;
    4.0;
    1.0;
    1.0;
    4.0;
    2.0;
    1.0;
    1.0;
    3.0;
    1.0;
    1.0;
    4.0;
    4.0;
    4.0;
    4.0;
    1.0;
    4.0;
    1.0;
    1.0;
    4.0;
    1.0;
    1.0;
    3.0;
    2.0;
    1.0;
    1.0;
    4.0;
    2.0;
    1.0;
    1.0;
    1.0;
    2.0;
    2.0;
    2.0;
    3.0;
    4.0;
    1.0;
    3.0;
    2.0;
    4.0;
    2.0;
    3.0;
    4.0;
    3.0;
    4.0;
    2.0;
    2.0;
    3.0;
    4.0;
    3.0;
    1.0;
    1.0;
    2.0;
    1.0;
    1.0;
    1.0;
    2.0;
    3.0;
    4.0;
    3.0;
    4.0;
    2.0;
    3.0;
    3.0;
    2.0;
    1.0;
    3.0;
    2.0;
    1.0;
    3.0;
    4.0;
    4.0;
    1.0;
    2.0;
    2.0;
    2.0;
    4.0;
    2.0;
    3.0;
    4.0;
    4.0;
    2.0;
    1.0;
    2.0;
    2.0;
    4.0;
    2.0;
    2.0;
    3.0;
    4.0;
    4.0;
    3.0;
    3.0;
    2.0;
    4.0;
    1.0;
    1.0;
    4.0;
    2.0;
    1.0;
    2.0;
    2.0;
    3.0;
    1.0;
    1.0;
    2.0;
    3.0;
    3.0;
    3.0;
    3.0;
    1.0;
    2.0;
    1.0;
    2.0;
    1.0;
    1.0;
    4.0;
    3.0;
    1.0;
    4.0;
    2.0;
    1.0;
    1.0;
    4.0;
    1.0;
    2.0;
    1.0;
    2.0;
    4.0;
    3.0;
    1.0;
    2.0;
    1.0;
    2.0;
    2.0;
    4.0;
    2.0;
    2.0;
    1.0;
    4.0;
    1.0;
    2.0;
    4.0;
    2.0;
];

numRedes = 4;  % Número total de redes a generar
mseRendimiento = zeros(1, numRedes);  % Inicialización del vector de rendimiento

% Asegúrate de que 'entradas' y 'observaciones' tienen la misma cantidad de columnas
display(size(entradas))
display(size(observaciones))
%if size(entradas, 2) ~= size(observaciones, 1)
%    error('El número de columnas en "entradas" debe ser igual al número de filas en "observaciones".');
%end

% Entrenamiento de la red neuronal
entradas = entradas';
observaciones = observaciones';

for i = 1:numRedes
    % Configuración de la red neuronal
    R = [1 3; 1 3; 1 3; 1 3];  % Rango de los datos de entrada para cada característica
        
    switch i
        case 1
            disp("Configuración 1")
            S = [4 4 4 4 1];  % Configuración de capas y neuronas
        case 2
            disp("Configuración 2")
            S = [4 22 1];  % Configuración de capas y neuronas
        case 3
            disp("Configuración 3")
            S = [4 15 15 15 1];  % Configuración de capas y neuronas
        otherwise
            disp("Configuración 4")
            S = [4 5 4 4 1];  % Configuración de capas y neuronas
    end

    
    net = newff(R, S, {'tansig', 'tansig', 'tansig', 'tansig', 'purelin'});
    
    try
        % Código que podría causar un error
        neti = train(net, entradas, observaciones);
    
        % Simulación
        Y = sim(neti, entradas);
        
        % Cálculo del error y MSE
        e = observaciones - Y;
        mseRendimiento(i) = (1 / length(e)) * sum(e.^2);
        
        % Gráficos (opcional)
        figure;
        subplot(2, 1, 1);
        plot([1:length(observaciones)], observaciones, 'b', [1:length(Y)], Y, 'r');
        title(['Red ' num2str(i) ': Observaciones vs Predicciones']);
        legend('Observaciones', 'Predicciones');
        
        subplot(2, 1, 2);
        plot(e);
        title(['Red ' num2str(i) ': Error']);
    catch ME
        % Código que se ejecuta si hay un error
        disp(['Salio un error: ', ME.message]);
    end
    
end

% Mostrar el MSE de cada red
disp('MSE de cada red neuronal:');
disp(mseRendimiento);
